# Phase 2-3: Excel Import 및 모드 분리 기능 테스트 가이드

## 📋 개요

Phase 2-3에서 구현한 다음 기능들을 테스트하기 위한 종합 가이드입니다:
- **Phase 2:** Excel Import 기능
- **Phase 3:** 세부항목 ↔ 합계 동기화 (모드 분리)
- **Phase 3:** 시뮬레이터 조건부 비활성화

---

## ✅ 구현된 기능

### Phase 2: Excel Import

### 1. excel-importer.ts 유틸리티
- ✅ 쉬잇크루 원본 파일 파싱 (`parseSheatcrewExcel`)
- ✅ BEP Export 파일 파싱 (`parseBEPExportExcel`)
- ✅ 파일 형식 자동 감지 (`detectExcelType`)
- ✅ 데이터 변환 (`convertToCalculationInputs`)
- ✅ 유효성 검증 (`validateCalculationInputs`)

### 2. ImportExcelButton 컴포넌트
- ✅ 파일 업로드 버튼
- ✅ 파일 형식 자동 감지
- ✅ 제품 선택 다이얼로그 (쉬잇크루 파일용)
- ✅ 에러 처리 및 사용자 피드백
- ✅ 데이터 미리보기

### 3. Calculator 페이지 통합
- ✅ Import 핸들러
- ✅ 자동 입력 기능
- ✅ Toast 알림

### Phase 3: 모드 분리 (세부항목 동기화)

### 4. CalculatorForm 세부항목 동기화
- ✅ 세부 항목 존재 여부 감지
- ✅ 합계 필드 조건부 잠금 (disabled)
- ✅ 안내 메시지 표시
- ✅ 초기화 버튼 ("초기화하여 직접 입력")

### 5. SimulationPanel 조건부 비활성화
- ✅ `disabled` prop 추가
- ✅ 비활성화 상태 UI 표시
- ✅ 안내 메시지 ("세부 항목 모드")
- ✅ 세부 항목 모드 팁 표시

### 6. Calculator Page 통합
- ✅ 세부 항목 존재 여부 계산
- ✅ `simulatorDisabled` 상태 관리
- ✅ SimulationPanel에 disabled 전달

---

## 🧪 테스트 시나리오

### 테스트 준비
```bash
# 개발 서버 실행
npm run dev

# 브라우저에서
http://localhost:3000/calculator
```

### 테스트 파일 위치
- 쉬잇크루 원본: `docs/쉬잇크루_BEP마진계산기.xlsx`
- BEP Export 샘플: `docs/BEP_Export_2025-10-14.xlsx`

---

## 📝 수동 테스트 체크리스트

### 1️⃣ BEP Export 파일 Import (간단)

**목적:** 우리가 만든 Export 파일을 다시 Import

**절차:**
1. Calculator 페이지 접속
2. "Excel 파일 가져오기" 버튼 클릭
3. `BEP_Export_2025-10-14.xlsx` 선택
4. 자동으로 데이터가 입력됨 확인

**기대 결과:**
- ✅ 파일 선택 즉시 Import 완료
- ✅ "가져오기 완료" Toast 표시
- ✅ 판매가: 50,000 자동 입력
- ✅ 단위 변동비: 20,000 자동 입력
- ✅ 월 고정비: 3,000,000 자동 입력
- ✅ 목표 수익: 5,000,000 자동 입력
- ✅ 계산 결과 자동 표시

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 2️⃣ 쉬잇크루 원본 파일 Import (제품 선택)

**목적:** 쉬잇크루 원본 파일에서 제품 선택

**절차:**
1. Calculator 페이지 접속
2. "Excel 파일 가져오기" 버튼 클릭
3. `쉬잇크루_BEP마진계산기.xlsx` 선택
4. 제품 선택 다이얼로그 표시 확인
5. 첫 번째 제품 "대박날 나의 아이템" 클릭

**기대 결과:**
- ✅ 다이얼로그에 제품 목록 표시
- ✅ 각 제품 카드에 정보 표시:
  - 제품명
  - 제품 유형 (B2C, B2B, B2G)
  - 판매가
  - 변동비 합계
  - 고정비 합계
  - 공헌이익
- ✅ 제품 클릭 시 다이얼로그 닫힘
- ✅ 데이터 자동 입력
- ✅ "가져오기 완료" Toast 표시

**기대 입력값:**
- 판매가: 25,000
- 단위 변동비: 12,000 (5000+1500+500+1500+3000+500)
- 월 고정비: 3,450,000 (2000000+200000+300000+300000+300000+300000+50000)
- 목표 수익: 20,000,000

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 3️⃣ 잘못된 파일 형식 (에러 처리)

**목적:** 지원하지 않는 파일 형식 에러 처리

**절차:**
1. Calculator 페이지 접속
2. "Excel 파일 가져오기" 버튼 클릭
3. 텍스트 파일(.txt) 또는 이미지 파일(.png) 선택

**기대 결과:**
- ✅ 에러 메시지 표시
- ✅ "지원하지 않는 파일 형식입니다" 메시지
- ✅ 기존 입력값 유지 (변경 없음)

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 4️⃣ 공헌이익 0 이하 제품 (필터링)

**목적:** 유효하지 않은 제품 필터링 확인

**테스트 데이터 생성:**
- 쉬잇크루 원본 파일에서 제품 추가
- 판매가: 10,000
- 변동비 합계: 15,000 (판매가보다 큼)
- 공헌이익: -5,000 (음수)

**기대 결과:**
- ✅ 해당 제품이 다이얼로그에 표시되지만
- ✅ 반투명 처리 (opacity-50)
- ✅ "공헌이익 0 이하" 라벨 표시
- ✅ 클릭 불가능

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 5️⃣ 여러 번 Import (데이터 덮어쓰기)

**목적:** 연속 Import 시 데이터 덮어쓰기 확인

**절차:**
1. BEP Export 파일 Import (판매가 50,000)
2. 계산 결과 확인
3. 쉬잇크루 파일 Import (판매가 25,000)
4. 계산 결과 변경 확인

**기대 결과:**
- ✅ 첫 번째 Import: 판매가 50,000
- ✅ 손익분기점 계산됨
- ✅ 두 번째 Import: 판매가 25,000으로 덮어쓰기
- ✅ 손익분기점 재계산됨
- ✅ 각 Import 시 Toast 표시

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 6️⃣ 빈 파일 / 데이터 없는 파일 (에러 처리)

**목적:** 데이터가 없는 파일 처리

**절차:**
1. 빈 Excel 파일 생성
2. Import 시도

**기대 결과:**
- ✅ "파일에서 제품 데이터를 찾을 수 없습니다" 에러
- ✅ 에러 메시지 표시
- ✅ 기존 입력값 유지

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 7️⃣ Import → 계산 → Export 순환 (라운드트립)

**목적:** Import-Export 데이터 일관성 확인

**절차:**
1. 쉬잇크루 파일 Import
2. 계산 결과 확인
3. Excel Export
4. Export한 파일 다시 Import
5. 데이터 일치 확인

**기대 결과:**
- ✅ Import한 값과 Export한 파일의 값 일치
- ✅ 손익분기점 계산 결과 동일
- ✅ 데이터 손실 없음

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 8️⃣ UI/UX 테스트 (Phase 2)

**Import 버튼 상태:**
- [ ] 파일 선택 전: "Excel 파일 가져오기"
- [ ] 파일 처리 중: 스피너 + "파일 처리 중..."
- [ ] 완료 후: 원래 상태로 복귀

**다이얼로그:**
- [ ] 제품 카드 호버 시 배경색 변경
- [ ] 스크롤 가능 (400px 높이)
- [ ] 다이얼로그 닫기 버튼 작동

**에러 표시:**
- [ ] 에러 발생 시 빨간색 박스 표시
- [ ] AlertCircle 아이콘 표시
- [ ] 에러 메시지 줄바꿈 지원

---

### 9️⃣ 세부항목 동기화 테스트 (Phase 3) ⭐

**목적:** 세부항목 ↔ 합계 필드 동기화 및 잠금 기능 확인

**절차:**
1. Calculator 페이지 접속
2. "단위 변동비" 필드 하단의 "세부 항목 열기" 버튼 클릭
3. 세부 항목 펼침 확인
4. 원재료비 입력: 10,000원
5. 단위 변동비 필드 확인

**기대 결과:**
- ✅ 세부 항목 펼쳐짐
- ✅ 원재료비 입력 시 단위 변동비 자동 업데이트 (10,000원)
- ✅ 단위 변동비 필드 비활성화 (회색 배경)
- ✅ 패키지 추가 입력 (5,000원) → 단위 변동비 15,000원으로 업데이트
- ✅ 합계 검증 표시 (✅ 또는 ❌)

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 🔟 세부항목 초기화 테스트 (Phase 3) ⭐

**목적:** 세부항목 초기화 후 직접 입력 모드 복귀 확인

**절차:**
1. 세부 항목 입력된 상태 (위 테스트 9️⃣ 완료 후)
2. 세부 항목 섹션 닫기 버튼 클릭
3. 단위 변동비 필드 하단의 "초기화하여 직접 입력" 버튼 확인
4. 버튼 클릭
5. 단위 변동비 필드 편집 가능 확인

**기대 결과:**
- ✅ 세부 항목 닫혀도 합계 필드 여전히 잠금 상태
- ✅ 안내 메시지 표시: "세부항목으로 관리 중입니다"
- ✅ "초기화하여 직접 입력" 버튼 표시
- ✅ 버튼 클릭 시 세부 항목 데이터 제거
- ✅ 단위 변동비 필드 편집 가능 상태로 변경
- ✅ 배경색 흰색으로 복귀

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 1️⃣1️⃣ 시뮬레이터 비활성화 테스트 (Phase 3) ⭐

**목적:** 세부 항목 모드에서 시뮬레이터 비활성화 확인

**절차:**
1. Calculator 페이지 접속
2. 기본 값 입력 (판매가, 단위 변동비, 고정비)
3. 시뮬레이션 패널 활성 상태 확인
4. "세부 항목 열기" 클릭
5. 원재료비 입력
6. 시뮬레이션 패널 상태 확인

**기대 결과:**

**초기 상태 (빠른 모드):**
- ✅ 시뮬레이션 패널 활성
- ✅ 판매가/원가 슬라이더 표시
- ✅ 슬라이더 조작 가능

**세부 항목 입력 후:**
- ✅ 시뮬레이션 패널 비활성 UI 표시
- ✅ 제목: "시뮬레이션 [비활성]"
- ✅ 안내 메시지: "세부 항목 모드"
- ✅ 설명: "세부 항목 값을 직접 조정하여 영향을 확인하세요"
- ✅ 팁: "각 세부 항목을 조정하면 실시간으로 BEP가 재계산됩니다"
- ✅ 슬라이더 숨김

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

### 1️⃣2️⃣ 통합 워크플로우 테스트 (Phase 2+3) ⭐

**목적:** Excel Import → 세부항목 수정 → 시뮬레이터 복귀 전체 흐름 확인

**절차:**
1. 쉬잇크루 파일 Import (세부항목 포함)
2. 세부 항목 자동 펼침 확인
3. 시뮬레이터 비활성화 확인
4. 원재료비 수정 (5,000 → 4,500)
5. BEP 재계산 확인
6. 세부 항목 초기화
7. 시뮬레이터 활성화 확인
8. 판매가 슬라이더 조작
9. BEP 변화 확인

**기대 결과:**
- ✅ Import 시 세부항목 있으면 자동 펼침
- ✅ 시뮬레이터 자동 비활성화
- ✅ 세부항목 수정 시 실시간 BEP 재계산
- ✅ 초기화 후 시뮬레이터 활성화
- ✅ 슬라이더 조작 가능
- ✅ 모든 상태 전환 부드럽게 진행

**실제 결과:**
- [ ] 통과
- [ ] 실패 (사유: ________________)

---

## 🔧 자동화 테스트 (향후 구현)

### 단위 테스트 (Vitest)
```typescript
// src/lib/__tests__/excel-importer.test.ts

describe("parseSheatcrewExcel", () => {
  it("should parse valid file", async () => {});
  it("should handle empty file", async () => {});
  it("should filter invalid products", () => {});
});

describe("parseBEPExportExcel", () => {
  it("should parse BEP Export file", async () => {});
  it("should handle missing sheets", async () => {});
});

describe("validateCalculationInputs", () => {
  it("should validate valid data", () => {});
  it("should catch negative values", () => {});
  it("should catch zero contribution margin", () => {});
});
```

### E2E 테스트 (Playwright)
```typescript
// e2e/calculator-import.spec.ts

test("should import BEP Export file", async ({ page }) => {
  // 파일 업로드
  // 데이터 확인
  // 계산 결과 확인
});

test("should show product selection dialog", async ({ page }) => {
  // 쉬잇크루 파일 업로드
  // 다이얼로그 표시 확인
  // 제품 선택
});
```

---

## 🐛 알려진 이슈 및 제한사항

### 제한사항
1. **파일 형식**: `.xlsx`, `.xls`만 지원
2. **파일 크기**: 브라우저 메모리 제한 (일반적으로 수 MB 이내)
3. **쉬잇크루 파일 구조**: 고정된 열 위치 가정 (7행부터 데이터)

### 향후 개선 사항
1. 드래그 앤 드롭 지원
2. 파일 미리보기 (Import 전)
3. 다중 제품 Import 지원
4. CSV 파일 지원
5. Import 히스토리 저장

---

## 📊 테스트 결과 정리

### 수동 테스트 요약

**Phase 2: Excel Import (시나리오 1-8)**
- [ ] BEP Export Import: ___/___
- [ ] 쉬잇크루 Import: ___/___
- [ ] 에러 처리: ___/___
- [ ] UI/UX: ___/___

**Phase 3: 모드 분리 (시나리오 9-12)** ⭐
- [ ] 세부항목 동기화: ___/___
- [ ] 세부항목 초기화: ___/___
- [ ] 시뮬레이터 비활성화: ___/___
- [ ] 통합 워크플로우: ___/___

### 전체 통과율
- **Phase 2 테스트 항목:** 8개
- **Phase 3 테스트 항목:** 4개
- **총 테스트 항목:** 12개
- 통과: ___개
- 실패: ___개
- 통과율: ___%

---

## 🚀 테스트 실행 방법

### 빠른 테스트 (3분)
```bash
npm run dev
# 브라우저: http://localhost:3000/calculator
# 1. BEP Export 파일 Import
# 2. 쉬잇크루 파일 Import
# 3. 데이터 확인
```

### 전체 테스트 (15분)
```bash
# 위 체크리스트 1-8 모두 실행
```

---

**작성일:** 2025-10-14
**작성자:** Claude Code
**버전:** 1.0
