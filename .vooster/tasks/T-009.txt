# 엑셀 다운로드(.xlsx) 기능 구현(입력·결과·민감도 내보내기)

**Task ID:** T-009
**Status:** BACKLOG
**Importance:** MUST
**Complexity:** 6/10
**Urgency:** 8/10
**Dependencies:** T-003

## Description

# 요구사항
- 입력값, 계산 결과, 민감도 데이터를 .xlsx로 내보내기
- 워터마크 또는 주석 포함, 파일명 규칙 및 시트 구조 정의
- 사용자 친화적 서식: 헤더 스타일, 칼럼 너비, 숫자 포맷, Freeze Panes

# Implementation details
- 라이브러리: SheetJS xlsx v0.20.x 사용, 클라이언트 생성
- 시트 구성: Inputs, Results, Sensitivity, Readme 4개 시트
- 워터마크 대체: Readme 시트에 브랜드 안내와 사용 범위, 각 시트 A1에 흐린 워터마크 텍스트 삽입
- 데이터 타입: 숫자 셀 포맷 적용, 소수점 자리수 통일
- 성능: 대량 민감도 데이터는 스트리밍 변환 없이 AoA로 변환

# Pseudo-code
```ts
import * as XLSX from 'xlsx'
export function downloadXlsx(state:CalculationState){
  const wb = XLSX.utils.book_new()
  const inputsAoA = [['Field','Value'], ['price', state.inputs.price], ['unitCost', state.inputs.unitCost], ['fixedCost', state.inputs.fixedCost], ['targetProfit', state.inputs.targetProfit ?? '']]
  const resultsAoA = [['Metric','Value'], ['bepQuantity', state.results.bepQuantity], ['bepRevenue', state.results.bepRevenue], ['marginRate', state.results.marginRate], ['targetQuantity', state.results.targetQuantity ?? '']]
  const sensAoA = [['price','unitCost','bep','profit'], ...state.sensitivity.map(s=>[s.price,s.unitCost,s.bep,s.profit])]
  const readmeAoA = [['SHEATCREW'], ['This workbook is generated by BEP Calculator'], ['Free tier includes watermark.']]
  const s1 = XLSX.utils.aoa_to_sheet([['WATERMARK: SHEATCREW FREE'], ...inputsAoA])
  const s2 = XLSX.utils.aoa_to_sheet([['WATERMARK: SHEATCREW FREE'], ...resultsAoA])
  const s3 = XLSX.utils.aoa_to_sheet([['WATERMARK: SHEATCREW FREE'], ...sensAoA])
  const s4 = XLSX.utils.aoa_to_sheet(readmeAoA)
  XLSX.utils.book_append_sheet(wb, s1, 'Inputs'); XLSX.utils.book_append_sheet(wb, s2, 'Results'); XLSX.utils.book_append_sheet(wb, s3, 'Sensitivity'); XLSX.utils.book_append_sheet(wb, s4, 'Readme')
  XLSX.writeFile(wb, `BEP_Export_${new Date().toISOString().slice(0,10)}.xlsx`)
}
```

# 테스트 전략
- 호환성: MS Excel, Google Sheets, Numbers에서 열기 테스트
- 정확성: 값, 포맷, 시트 수 및 이름 검증
- 성능: 10k 행 민감도 데이터 생성 시간 측정, 2초 이내 목표
- 국제화: 소수점 표기, 날짜 포맷 이슈 유무 확인

---

**Created:** 2025-10-09T16:19:10.736Z
**Updated:** 2025-10-09T16:19:10.736Z
